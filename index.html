<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ch√∫c M·ª´ng Sinh Nh·∫≠t - Tr·∫ßn Ph∆∞∆°ng Th·ªßy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background-color: #1a1a2e;
        color: #fff;
        overflow: hidden;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        cursor: pointer; /* Th√™m con tr·ªè tay ƒë·ªÉ g·ª£i √Ω click */
      }

      /* --- STYLES CHO PH·∫¶N TH√îNG TIN --- */
      .profile-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 2rem;
        z-index: 20;
        transition: all 0.5s ease;
      }

      .avatar-frame {
        width: 130px;
        height: 130px;
        border-radius: 50%;
        border: 4px solid #f472b6; /* Pink border */
        padding: 4px;
        background: rgba(255, 255, 255, 0.1);
        box-shadow: 0 0 20px rgba(244, 114, 182, 0.4);
        margin-bottom: 10px;
        overflow: hidden;
        position: relative;
      }

      .avatar-img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
      }

      .user-name {
        font-size: 1.8rem;
        font-weight: 700;
        color: #fbcfe8; /* Light pink */
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        margin-bottom: 0;
      }

      .user-year {
        font-size: 1.1rem;
        color: #fde047; /* Yellow */
        font-style: italic;
        background: rgba(0, 0, 0, 0.3);
        padding: 2px 12px;
        border-radius: 15px;
        margin-top: 5px;
      }

      /* --- H√åNH H√ÄI H∆Ø·ªöC (XU·∫§T HI·ªÜN SAU) --- */
      .funny-popup {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0) rotate(-15deg);
        max-width: 300px;
        width: 80%;
        border: 8px solid white;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
        z-index: 30; /* D∆∞·ªõi ch·ªØ ch√∫c m·ª´ng nh∆∞ng tr√™n b√°nh */
        opacity: 0;
        transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        pointer-events: none;
      }

      .funny-popup.show {
        opacity: 1;
        transform: translate(-50%, -60%) scale(1) rotate(-5deg);
      }

      /* --- C√ÅC HI·ªÜU ·ª®NG C≈® --- */
      .flame {
        width: 15px;
        height: 35px;
        background: linear-gradient(-45deg, red, orange, yellow);
        border-radius: 50% 50% 20% 20%;
        position: absolute;
        top: -35px;
        left: 50%;
        transform: translateX(-50%);
        box-shadow:
          0 0 10px 2px rgba(255, 165, 0, 0.6),
          0 0 20px 4px rgba(255, 69, 0, 0.4),
          0 0 60px 8px rgba(255, 255, 0, 0.2);
        animation: flicker 0.1s infinite alternate;
        transform-origin: center bottom;
        z-index: 10;
      }

      @keyframes flicker {
        0% {
          transform: translateX(-50%) skewX(2deg) scaleY(1);
          opacity: 1;
        }
        100% {
          transform: translateX(-50%) skewX(-2deg) scaleY(0.9);
          opacity: 0.9;
        }
      }

      .flame.out {
        animation: puff-out 0.5s forwards;
      }

      @keyframes puff-out {
        0% {
          transform: translateX(-50%) scale(1);
          opacity: 1;
        }
        50% {
          transform: translateX(-50%) scale(1.2);
          opacity: 0.5;
          background: gray;
        }
        100% {
          transform: translateX(-50%) scale(0);
          opacity: 0;
        }
      }

      .smoke {
        position: absolute;
        top: -40px;
        left: 50%;
        transform: translateX(-50%);
        width: 10px;
        height: 30px;
        background: rgba(255, 255, 255, 0.4);
        filter: blur(5px);
        border-radius: 50%;
        opacity: 0;
        z-index: 9;
      }

      .smoke.active {
        animation: rise 1.5s ease-out forwards;
      }

      @keyframes rise {
        0% {
          opacity: 0;
          top: -35px;
        }
        20% {
          opacity: 0.8;
        }
        100% {
          opacity: 0;
          top: -80px;
          transform: translateX(-60%) scale(2);
        }
      }

      .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: #f00;
        animation: fall linear forwards;
        top: -10vh;
        z-index: 100;
      }

      @keyframes fall {
        to {
          transform: translateY(110vh) rotate(720deg);
        }
      }

      .hbd-text {
        text-shadow:
          0 0 10px #ff00de,
          0 0 20px #ff00de,
          0 0 40px #ff00de;
        opacity: 0;
        transform: scale(0.5);
        transition: all 1s ease;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.5);
        width: 100%;
        text-align: center;
        z-index: 50; /* Tr√™n c√πng */
      }
      .hbd-text.show {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translate(-50%, -50%);
        }
        50% {
          transform: translate(-50%, -60%);
        }
      }

      /* --- ·∫¢NH TRANG TR√ç 2 B√äN --- */
      .side-images {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 2rem;
        z-index: 5;
      }

      .side-images.left {
        left: 2rem;
      }

      .side-images.right {
        right: 2rem;
      }

      .side-img {
        max-width: 280px;
        max-height: 170px;
        width: auto;
        height: auto;
        border-radius: 12px;
        border: 5px solid #fff;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        background: #fff;
        opacity: 0;
        animation: fadeInFloat 1s ease-out forwards;
      }

      .side-img:nth-child(1) {
        animation-delay: 0.3s;
      }

      .side-img:nth-child(2) {
        animation-delay: 0.6s;
      }

      .side-img:nth-child(3) {
        animation-delay: 0.9s;
      }

      .side-images.left .side-img {
        animation-name: fadeInFloatLeft;
      }

      .side-images.right .side-img {
        animation-name: fadeInFloatRight;
      }

      @keyframes fadeInFloatLeft {
        0% {
          opacity: 0;
          transform: translateX(-100px) translateY(-20px) rotate(-15deg)
            scale(0.5);
        }
        60% {
          opacity: 1;
          transform: translateX(10px) translateY(0) rotate(2deg) scale(1.05);
        }
        100% {
          opacity: 1;
          transform: translateX(0) translateY(0) rotate(0deg) scale(1);
        }
      }

      @keyframes fadeInFloatRight {
        0% {
          opacity: 0;
          transform: translateX(100px) translateY(-20px) rotate(15deg)
            scale(0.5);
        }
        60% {
          opacity: 1;
          transform: translateX(-10px) translateY(0) rotate(-2deg) scale(1.05);
        }
        100% {
          opacity: 1;
          transform: translateX(0) translateY(0) rotate(0deg) scale(1);
        }
      }

      .side-img {
        animation-fill-mode: forwards;
      }

      .side-img:hover {
        transform: scale(1.15) rotate(3deg) translateY(-5px);
        transition: all 0.4s ease;
        box-shadow: 0 15px 40px rgba(244, 114, 182, 0.6);
        z-index: 10;
      }

      /* Animation l·∫Øc l∆∞ li√™n t·ª•c */
      @keyframes sway {
        0%,
        100% {
          transform: rotate(-3deg);
        }
        50% {
          transform: rotate(3deg);
        }
      }

      .side-img.loaded {
        animation: sway 3s ease-in-out infinite;
        animation-delay: 1.5s;
      }

      /* --- CH·ªÆ TR√äN B√ÅNH KEM --- */
      .cake-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: "Brush Script MT", cursive, "Segoe UI", sans-serif;
        font-size: 1.2rem;
        font-weight: bold;
        color: #ec4899;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        z-index: 10;
        white-space: nowrap;
        pointer-events: none;
      }

      .cake-text-top {
        font-size: 0.9rem;
        top: 40%;
        color: #db2777;
      }
    </style>
  </head>
  <body class="h-screen w-full flex flex-col items-center relative">
    <!-- Audio Player (·∫®n) -->
    <audio id="bg-music" loop autoplay>
      <source src="./andriig-happy-birthday-471211.mp3" type="audio/ogg" />
      Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª audio.
    </audio>

    <!-- ·∫¢nh trang tr√≠ b√™n tr√°i -->
    <div class="side-images left">
      <img
        src="./bride.png"
        alt="Memory 1"
        class="side-img"
        onload="this.classList.add('loaded')"
      />
      <img
        src="./meo.png"
        alt="Memory 2"
        class="side-img"
        onload="this.classList.add('loaded')"
      />
      <img
        src="./hi.png"
        alt="Memory 3"
        class="side-img"
        onload="this.classList.add('loaded')"
      />
    </div>

    <!-- ·∫¢nh trang tr√≠ b√™n ph·∫£i -->
    <div class="side-images right">
      <img
        src="./meme.png"
        alt="Memory 4"
        class="side-img"
        onload="this.classList.add('loaded')"
      />
      <img
        src="./tim.png"
        alt="Memory 5"
        class="side-img"
        onload="this.classList.add('loaded')"
      />
      <img
        src="./heo.png"
        alt="Memory 6"
        class="side-img"
        onload="this.classList.add('loaded')"
      />
    </div>

    <!-- Th√¥ng tin Ch·ªß Ti·ªác -->
    <div class="profile-container">
      <div class="avatar-frame">
        <img
          src="thuy.png"
          alt="Tr·∫ßn Ph∆∞∆°ng Th·ªßy"
          class="avatar-img"
          id="user-photo"
        />
      </div>
      <h2 class="user-name">Tr·∫ßn Ph∆∞∆°ng Th·ªßy</h2>
      <div class="user-year">üêçüêç Tu·ªïi T√¢n T·ªµ üêçüêç</div>
    </div>

    <!-- H∆∞·ªõng d·∫´n (Thay ƒë·ªïi n·ªôi dung) -->
    <div
      id="instruction"
      class="mt-4 text-gray-400 text-sm animate-pulse transition-opacity duration-500 opacity-1 z-10"
    >
      (Ch·∫°m v√¥ m√†n h√¨nh c√°i ƒëi m√°)
    </div>

    <!-- Th√¥ng b√°o ch√∫c m·ª´ng -->
    <h1
      id="hbd-message"
      class="hbd-text text-4xl md:text-6xl font-bold text-yellow-300"
    >
      CH√öC M·ª™NG SINH NH·∫¨T! <br />
      <span class="text-2xl md:text-4xl text-white mt-2 block drop-shadow-lg"
        >Ph∆∞∆°ng Th·ªßy</span
      >
    </h1>

    <!-- B√°nh Kem -->
    <div
      id="cake-container"
      class="relative mt-auto mb-10 cursor-pointer transform transition hover:scale-105 duration-300"
    >
      <!-- ƒêƒ©a -->
      <div
        class="absolute bottom-[-12px] left-1/2 -translate-x-1/2 w-72 h-5 bg-gradient-to-b from-gray-200 to-gray-400 rounded-full shadow-2xl"
        style="box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3)"
      ></div>

      <!-- T·∫ßng d∆∞·ªõi -->
      <div
        class="relative w-64 h-28 bg-gradient-to-b from-pink-100 via-pink-50 to-pink-100 rounded-2xl shadow-2xl mx-auto border-b-8 border-pink-200"
        style="
          box-shadow:
            0 8px 20px rgba(244, 114, 182, 0.3),
            inset 0 2px 10px rgba(255, 255, 255, 0.5);
        "
      >
        <!-- Trang tr√≠ kem vi·ªÅn -->
        <div
          class="absolute top-0 left-0 right-0 h-7 bg-gradient-to-r from-pink-400 via-pink-300 to-pink-400 rounded-full translate-y-[-50%]"
          style="box-shadow: 0 4px 10px rgba(244, 114, 182, 0.4)"
        ></div>

        <!-- Hoa trang tr√≠ -->
        <div class="absolute bottom-5 left-0 right-0 flex justify-around px-4">
          <div class="relative">
            <div class="w-5 h-5 bg-yellow-300 rounded-full shadow-md"></div>
            <div
              class="absolute inset-0 w-5 h-5 bg-yellow-200 rounded-full animate-pulse"
            ></div>
          </div>
          <div class="relative">
            <div class="w-5 h-5 bg-rose-400 rounded-full shadow-md"></div>
            <div
              class="absolute inset-0 w-5 h-5 bg-rose-300 rounded-full animate-pulse"
            ></div>
          </div>
          <div class="relative">
            <div class="w-5 h-5 bg-purple-400 rounded-full shadow-md"></div>
            <div
              class="absolute inset-0 w-5 h-5 bg-purple-300 rounded-full animate-pulse"
            ></div>
          </div>
          <div class="relative">
            <div class="w-5 h-5 bg-blue-400 rounded-full shadow-md"></div>
            <div
              class="absolute inset-0 w-5 h-5 bg-blue-300 rounded-full animate-pulse"
            ></div>
          </div>
        </div>

        <!-- H·ªça ti·∫øt s√≥ng -->
        <div
          class="absolute bottom-2 left-0 right-0 flex justify-center space-x-1"
        >
          <div class="w-2 h-2 bg-pink-300 rounded-full opacity-60"></div>
          <div class="w-2 h-2 bg-pink-300 rounded-full opacity-60"></div>
          <div class="w-2 h-2 bg-pink-300 rounded-full opacity-60"></div>
        </div>

        <!-- L·ªùi ch√∫c tr√™n b√°nh t·∫ßng d∆∞·ªõi -->
        <div class="cake-text">‚ú® Happy Birthday ‚ú®</div>
      </div>

      <!-- T·∫ßng tr√™n -->
      <div
        class="relative w-44 h-24 bg-gradient-to-b from-rose-100 via-rose-50 to-rose-100 rounded-2xl shadow-2xl mx-auto -mt-5 border-b-8 border-rose-200"
        style="
          box-shadow:
            0 6px 16px rgba(244, 114, 182, 0.35),
            inset 0 2px 8px rgba(255, 255, 255, 0.6);
        "
      >
        <!-- Trang tr√≠ kem vi·ªÅn -->
        <div
          class="absolute top-0 left-0 right-0 h-6 bg-gradient-to-r from-rose-400 via-pink-300 to-rose-400 rounded-full translate-y-[-50%]"
          style="box-shadow: 0 3px 8px rgba(244, 114, 182, 0.4)"
        ></div>

        <!-- D√¢u t√¢y trang tr√≠ tr√™n t·∫ßng 2 -->
        <div class="absolute bottom-3 left-1/2 -translate-x-1/2 flex space-x-3">
          <div class="relative">
            <div
              class="w-4 h-4 bg-red-500 rounded-full shadow-md"
              style="clip-path: polygon(50% 0%, 100% 100%, 0% 100%)"
            ></div>
            <div
              class="absolute top-0 left-1/2 -translate-x-1/2 w-2 h-1 bg-green-500"
            ></div>
          </div>
          <div class="relative">
            <div
              class="w-4 h-4 bg-red-500 rounded-full shadow-md"
              style="clip-path: polygon(50% 0%, 100% 100%, 0% 100%)"
            ></div>
            <div
              class="absolute top-0 left-1/2 -translate-x-1/2 w-2 h-1 bg-green-500"
            ></div>
          </div>
        </div>

        <!-- L·ªùi ch√∫c tr√™n b√°nh t·∫ßng tr√™n -->
        <div class="cake-text cake-text-top">üéÄ Ph∆∞∆°ng Th·ªßy üéÄ</div>
      </div>

      <!-- N·∫øn -->
      <div
        class="absolute top-[-20px] left-1/2 -translate-x-1/2 flex space-x-6"
      >
        <!-- N·∫øn 1 -->
        <div
          class="candle relative w-4 h-16 bg-gradient-to-b from-blue-300 to-blue-500 rounded-sm shadow-md"
        >
          <div
            class="wick w-0.5 h-3 bg-gray-700 absolute -top-3 left-1/2 -translate-x-1/2"
          ></div>
          <div class="flame" id="flame1"></div>
          <div class="smoke" id="smoke1"></div>
        </div>
        <!-- N·∫øn 2 (Gi·ªØa) -->
        <div
          class="candle relative w-4 h-20 bg-gradient-to-b from-green-300 to-green-500 rounded-sm shadow-md -mt-4"
        >
          <div
            class="wick w-0.5 h-3 bg-gray-700 absolute -top-3 left-1/2 -translate-x-1/2"
          ></div>
          <div class="flame" id="flame2"></div>
          <div class="smoke" id="smoke2"></div>
        </div>
        <!-- N·∫øn 3 -->
        <div
          class="candle relative w-4 h-16 bg-gradient-to-b from-purple-300 to-purple-500 rounded-sm shadow-md"
        >
          <div
            class="wick w-0.5 h-3 bg-gray-700 absolute -top-3 left-1/2 -translate-x-1/2"
          ></div>
          <div class="flame" id="flame3"></div>
          <div class="smoke" id="smoke3"></div>
        </div>
      </div>
    </div>

    <script>
      let isListening = false;
      let candlesOut = false;
      let audioContext;
      let analyser;
      let microphone;
      let dataArray;
      let hasInteracted = false;

      const instruction = document.getElementById("instruction");
      const cakeContainer = document.getElementById("cake-container");
      const hbdMessage = document.getElementById("hbd-message");
      const flames = document.querySelectorAll(".flame");
      const smokes = document.querySelectorAll(".smoke");
      const bgMusic = document.getElementById("bg-music");

      // T·ª± ƒë·ªông b·∫Øn ph√°o gi·∫•y ngay khi load
      window.onload = () => {
        startConfetti();
      };

      // H√†m kh·ªüi t·∫°o chung cho l·∫ßn ch·∫°m ƒë·∫ßu ti√™n
      async function initParty() {
        if (hasInteracted) return;
        hasInteracted = true;

        // 1. Ph√°t nh·∫°c
        try {
          bgMusic.volume = 0.5;
          bgMusic.play();
        } catch (e) {
          console.log("Autoplay blocked until interaction");
        }

        // 2. K√≠ch ho·∫°t Micro
        try {
          await startMicrophone();
          instruction.innerHTML =
            "Ch√∫c Ph∆∞∆°ng Th·ªßy nh·ªØng ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t, nh·ªØng th·ª© tuy·ªát c√† l√† v·ªùi s·∫Ω ƒë·∫øn v·ªõi m√†y,<br>" +
            "nh·ªØng c√¢u chuy·ªán drama m·ªõi s·∫Ω ƒë·∫øn v·ªõi m√†y<br>" +
            "nhi·ªÅu ni·ªÅm vui, n·ªïi bu·ªìn qua ƒëi, v√† y√™u th∆∞∆°ng tao nhi·ªÅu h∆°n<br>" +
            "Gi·ªù th√¨ th·ªïi n·∫øn ƒëi n√†o!";
        } catch (err) {
          console.error("Kh√¥ng th·ªÉ truy c·∫≠p micro:", err);
          instruction.textContent = "H√£y ch·∫°m v√†o b√°nh ƒë·ªÉ t·∫Øt n·∫øn!";
        }
      }

      // B·∫Øt s·ª± ki·ªán ch·∫°m/click b·∫•t k·ª≥ ƒë√¢u tr√™n trang ƒë·ªÉ k√≠ch ho·∫°t
      document.body.addEventListener("click", initParty);
      document.body.addEventListener("touchstart", initParty);

      // Click ri√™ng v√†o b√°nh ƒë·ªÉ t·∫Øt n·∫øn (n·∫øu ƒë√£ init)
      cakeContainer.addEventListener("click", (e) => {
        e.stopPropagation(); // NgƒÉn s·ª± ki·ªán body click l·∫∑p l·∫°i
        if (!hasInteracted) initParty();
        if (!candlesOut) blowOutCandles();
      });

      async function startMicrophone() {
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({
              audio: true,
            });
            audioContext = new (
              window.AudioContext || window.webkitAudioContext
            )();
            analyser = audioContext.createAnalyser();
            microphone = audioContext.createMediaStreamSource(stream);
            microphone.connect(analyser);

            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);

            isListening = true;
            detectBlow();
          } catch (err) {
            throw err;
          }
        }
      }

      function detectBlow() {
        if (!isListening || candlesOut) return;

        requestAnimationFrame(detectBlow);
        analyser.getByteFrequencyData(dataArray);

        let sum = 0;
        for (let i = 0; i < dataArray.length; i++) {
          sum += dataArray[i];
        }
        let average = sum / dataArray.length;

        const THRESHOLD = 40;

        if (average > THRESHOLD) {
          blowOutCandles();
        }
      }

      function blowOutCandles() {
        if (candlesOut) return;
        candlesOut = true;
        isListening = false;

        if (audioContext) audioContext.close();

        flames.forEach((flame, index) => {
          setTimeout(() => {
            flame.classList.add("out");
            smokes[index].classList.add("active");
          }, index * 100);
        });

        setTimeout(() => {
          instruction.style.opacity = "0";
          hbdMessage.classList.add("show");

          // B·∫Øn th√™m m·ªôt ƒë·ª£t ph√°o gi·∫•y n·ªØa khi th·ªïi n·∫øn
          startConfetti();
        }, 600);
      }

      function startConfetti() {
        const colors = ["#f00", "#0f0", "#00f", "#ff0", "#0ff", "#f0f", "#fff"];
        // TƒÉng s·ªë l∆∞·ª£ng ph√°o
        for (let i = 0; i < 150; i++) {
          setTimeout(() => {
            const confetti = document.createElement("div");
            confetti.classList.add("confetti");
            confetti.style.left = Math.random() * 100 + "vw";
            confetti.style.backgroundColor =
              colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDuration = Math.random() * 3 + 2 + "s";
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 5000);
          }, i * 30);
        }
      }
    </script>
  </body>
</html>
